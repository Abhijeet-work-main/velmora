<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velmora - Advanced Web Scraper Platform</title>
    <meta name="description" content="Professional web scraping platform with real-time data aggregation, news monitoring, stock tracking, and custom scrapers">
    <meta name="keywords" content="web scraping, news aggregation, stock tracking, data monitoring, real-time">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Socket.IO for real-time updates -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --primary-color: #3B82F6;
            --secondary-color: #8B5CF6;
            --accent-color: #F59E0B;
            --success-color: #10B981;
            --error-color: #EF4444;
            --warning-color: #F59E0B;
            --dark-bg: #0F172A;
            --card-bg: #1E293B;
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --border-color: #334155;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .loading-shimmer {
            background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .pulse-dot {
            animation: pulse-dot 2s infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 10px 22px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-secondary:hover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online { background: var(--success-color); }
        .status-offline { background: var(--error-color); }
        .status-warning { background: var(--warning-color); }
        
        .metric-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .article-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .article-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background: var(--card-bg);
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-success { background: var(--success-color); }
        .toast-error { background: var(--error-color); }
        .toast-warning { background: var(--warning-color); }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 280px;
            background: var(--card-bg);
            border-right: 1px solid var(--border-color);
            transition: transform 0.3s ease;
            z-index: 100;
        }
        
        .sidebar-hidden {
            transform: translateX(-100%);
        }
        
        .main-content {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }
        
        .main-content.sidebar-hidden {
            margin-left: 0;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        .dark-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        
        .dark-scrollbar::-webkit-scrollbar-track {
            background: var(--card-bg);
        }
        
        .dark-scrollbar::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        .dark-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background: var(--primary-color);
            color: white;
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 16px;
        }
    </style>
</head>
<body class="dark-scrollbar">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-rocket text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-white">Velmora</h1>
                    <p class="text-sm text-gray-400">Advanced Scraper</p>
                </div>
            </div>
        </div>
        
        <nav class="p-4">
            <div class="space-y-2">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="news-scraper">
                    <i class="fas fa-newspaper"></i>
                    <span>News Scraper</span>
                </a>
                <a href="#" class="nav-item" data-section="stock-tracker">
                    <i class="fas fa-chart-bar"></i>
                    <span>Stock Tracker</span>
                </a>
                <a href="#" class="nav-item" data-section="crypto-monitor">
                    <i class="fab fa-bitcoin"></i>
                    <span>Crypto Monitor</span>
                </a>
                <a href="#" class="nav-item" data-section="ecommerce">
                    <i class="fas fa-shopping-cart"></i>
                    <span>E-commerce</span>
                </a>
                <a href="#" class="nav-item" data-section="social">
                    <i class="fas fa-share-alt"></i>
                    <span>Social Media</span>
                </a>
                <a href="#" class="nav-item" data-section="custom-scraper">
                    <i class="fas fa-cog"></i>
                    <span>Custom Scraper</span>
                </a>
                <a href="#" class="nav-item" data-section="history">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <i class="fas fa-settings"></i>
                    <span>Settings</span>
                </a>
            </div>
        </nav>
        
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-700">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-sm"></i>
                </div>
                <div class="flex-1">
                    <p class="text-sm font-medium" id="user-name">Guest User</p>
                    <p class="text-xs text-gray-400" id="user-status">Free Plan</p>
                </div>
                <button class="btn-secondary" id="auth-btn" onclick="toggleAuth()">
                    <i class="fas fa-sign-in-alt"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="main-content">
        <!-- Header -->
        <header class="bg-slate-800 border-b border-gray-700 p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <button class="btn-secondary lg:hidden" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 class="text-xl font-semibold" id="page-title">Dashboard</h2>
                    <div class="flex items-center gap-2">
                        <span class="status-indicator pulse-dot" id="connection-status"></span>
                        <span class="text-sm text-gray-400" id="connection-text">Connected</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <input type="text" 
                               placeholder="Search..." 
                               class="bg-slate-700 text-white px-4 py-2 rounded-lg pl-10 w-64 focus:outline-none focus:ring-2 focus:ring-blue-500"
                               id="global-search-input">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                    <button class="btn-primary" id="start-scraping-btn">
                        <i class="fas fa-play"></i>
                        <span>Start Scraping</span>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Content Sections -->
        <main class="p-6">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="section active">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="metric-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Total Scraped</p>
                                <p class="text-2xl font-bold" id="total-scraped">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-database text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Success Rate</p>
                                <p class="text-2xl font-bold" id="success-rate">0%</p>
                            </div>
                            <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Active Jobs</p>
                                <p class="text-2xl font-bold" id="active-jobs">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-clock text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Last Update</p>
                                <p class="text-sm" id="last-update">Never</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-refresh text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                        <div class="space-y-4" id="recent-activity">
                            <div class="flex items-center gap-3 p-3 bg-slate-700 rounded-lg">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-newspaper text-xs"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm">News scraping completed</p>
                                    <p class="text-xs text-gray-400">2 minutes ago</p>
                                </div>
                            </div>
                        </div>
                        <div id="recent-activity-list">
                            <!-- Recent activity items will be added here -->
                        </div>
                    </div>
                    
                                    <div class="glass-card p-6">
                    <h3 class="text-lg font-semibold mb-4">Performance Chart</h3>
                    <canvas id="performance-chart" width="400" height="200"></canvas>
                </div>
                
                <!-- Global Search Results -->
                <div class="glass-card p-6" id="global-search-results-section" style="display: none;">
                    <h3 class="text-lg font-semibold mb-4">Search Results</h3>
                    <div id="global-search-results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Global search results will be displayed here -->
                    </div>
                </div>
                </div>
            </section>
            
            <!-- Mood Playlist Section -->
<section id="mood-playlist" style="margin: 2rem 0; padding: 2rem; background: rgba(30, 41, 59, 0.7); border-radius: 16px;">
  <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">Mood Playlist</h2>
  
  <!-- Language Selection -->
  <div style="margin-bottom: 1rem;">
    <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Select Language:</label>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
      <button onclick="selectLanguage('english')" class="lang-btn active" data-lang="english" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üá∫üá∏ English</button>
      <button onclick="selectLanguage('hindi')" class="lang-btn" data-lang="hindi" style="background: #6b7280; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üáÆüá≥ Hindi</button>
      <button onclick="selectLanguage('punjabi')" class="lang-btn" data-lang="punjabi" style="background: #6b7280; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üáÆüá≥ Punjabi</button>
    </div>
  </div>
  
  <!-- Mood Selection Buttons -->
  <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
    <button onclick="selectMood('happy')" class="mood-btn" data-mood="happy" style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">üòä Happy</button>
    <button onclick="selectMood('sad')" class="mood-btn" data-mood="sad" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">üò¢ Sad</button>
    <button onclick="selectMood('romantic')" class="mood-btn" data-mood="romantic" style="background: #ec4899; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">üíï Romantic</button>
    <button onclick="selectMood('energetic')" class="mood-btn" data-mood="energetic" style="background: #f59e0b; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">‚ö° Energetic</button>
    <button onclick="selectMood('calm')" class="mood-btn" data-mood="calm" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">üçÉ Calm</button>
    <button onclick="selectMood('party')" class="mood-btn" data-mood="party" style="background: #8b5cf6; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">üéâ Party</button>
  </div>
  
             <!-- Search and Generate -->
           <div style="margin-bottom: 1rem;">
             <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
               <input type="text" id="song-search" placeholder="Search for specific songs..." style="flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid #374151; border-radius: 6px; background: #1f2937; color: white;">
               <button onclick="searchSongs()" style="background: #059669; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üîç Search</button>
               <button onclick="generateMoodPlaylist()" id="generate-btn" style="background: #dc2626; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üéµ Generate Playlist</button>
             </div>
             <div style="margin-top: 0.5rem;">
               <button onclick="togglePlayMode()" id="play-mode-btn" style="background: #7c3aed; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">üéµ High Quality Audio</button>
               <span style="color: #9ca3af; font-size: 0.8rem; margin-left: 0.5rem;">Pure audio streaming - no videos, just music</span>
             </div>
           </div>
  
  <!-- Loading Indicator -->
  <div id="loading-indicator" style="display: none; text-align: center; padding: 2rem;">
    <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #374151; border-top: 4px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
    <p style="margin-top: 1rem;">Scraping songs for your mood...</p>
  </div>
  
  <!-- Playlist Info -->
  <div id="playlist-info" style="margin-bottom: 1rem; display: none;">
    <h3 id="current-mood-title" style="font-size: 1.2rem; margin-bottom: 0.5rem;"></h3>
    <button onclick="playMoodPlaylist()" id="play-btn" style="background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 1.2em; cursor: pointer;">‚ñ∂Ô∏è Play All</button>
  </div>
  
  <!-- Music Player -->
  <div id="music-player" style="display:none; margin-top: 1rem;">
    <div style="background: #1f2937; border-radius: 12px; padding: 1rem; border: 1px solid #374151;">
      <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <div style="width: 60px; height: 60px; background: linear-gradient(45deg, #3b82f6, #8b5cf6); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-music" style="color: white; font-size: 1.5rem;"></i>
        </div>
        <div style="flex: 1;">
          <div id="current-song-title" style="font-weight: bold; font-size: 1.1rem;">No song playing</div>
          <div id="current-song-artist" style="color: #9ca3af;">-</div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
          <button onclick="previousTrack()" style="background: #374151; color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer;">
            <i class="fas fa-step-backward"></i>
          </button>
          <button onclick="togglePlayPause()" id="play-pause-btn" style="background: #3b82f6; color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer;">
            <i class="fas fa-play"></i>
          </button>
          <button onclick="nextTrack()" style="background: #374151; color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer;">
            <i class="fas fa-step-forward"></i>
          </button>
        </div>
      </div>
      
      <!-- Audio Player Container -->
      <div id="audio-container" style="margin-bottom: 1rem;">
        <!-- Audio controls will be here -->
      </div>
      
      <!-- Progress Bar -->
      <div style="margin-bottom: 0.5rem;">
        <div style="background: #374151; height: 4px; border-radius: 2px; position: relative; cursor: pointer;" onclick="seekTo(event)">
          <div id="progress-bar" style="background: #3b82f6; height: 100%; border-radius: 2px; width: 0%; transition: width 0.1s;"></div>
        </div>
      </div>
      
      <!-- Time Display -->
      <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #9ca3af;">
        <span id="current-time">0:00</span>
        <span id="total-time">0:00</span>
      </div>
      
      <!-- Volume Control -->
      <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
        <i class="fas fa-volume-down" style="color: #9ca3af;"></i>
        <input type="range" id="volume-control" min="0" max="100" value="50" style="flex: 1; height: 4px; background: #374151; border-radius: 2px; outline: none;">
        <i class="fas fa-volume-up" style="color: #9ca3af;"></i>
      </div>
    </div>
  </div>
  
  <!-- Hidden Audio Element for Background Playback -->
  <audio id="audio-player" style="display: none;"></audio>
  
  <!-- Track List -->
  <div id="track-list" style="margin-top: 1rem; display: none;">
    <h4 style="margin-bottom: 0.5rem;">Tracks:</h4>
    <div id="tracks-container"></div>
  </div>
</section>

<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

            
            <!-- News Scraper Section -->
            <section id="news-scraper" class="dashboard-section hidden">
                <h2 class="text-2xl font-bold mb-6 text-white">News Scraper</h2>
                <div class="glass-card p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <input type="text" id="news-keywords" placeholder="Enter keywords..." class="bg-slate-700 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <select id="news-category" class="bg-slate-700 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="general">General</option>
                            <option value="business">Business</option>
                            <option value="technology">Technology</option>
                            <option value="sports">Sports</option>
                        </select>
                        <select id="news-source" class="bg-slate-700 text-white px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="all">All Sources</option>
                            <option value="bbc">BBC</option>
                            <option value="cnn">CNN</option>
                            <option value="reuters">Reuters</option>
                        </select>
                    </div>
                    <button id="scrape-news-btn" class="btn-primary">
                        <i class="fas fa-search"></i>
                        Scrape News
                    </button>
                </div>
                <div id="news-results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- News results will be displayed here -->
                </div>
            </section>

            <!-- Stock Tracker Section -->
            <section id="stock-tracker" class="dashboard-section hidden">
                <h2 class="text-2xl font-bold mb-6 text-white">Stock Tracker</h2>
                <div id="stock-data-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Stock data will be displayed here -->
                </div>
            </section>

            <!-- Crypto Monitor Section -->
            <section id="crypto-monitor" class="dashboard-section hidden">
                <h2 class="text-2xl font-bold mb-6 text-white">Crypto Monitor</h2>
                <div id="crypto-data-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Crypto data will be displayed here -->
                </div>
            </section>

            <!-- E-commerce Section -->
            <section id="ecommerce" class="dashboard-section hidden">
                <h2 class="text-2xl font-bold mb-6 text-white">E-commerce</h2>
                <div id="ecommerce-results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- E-commerce results will be displayed here -->
                </div>
            </section>

            <!-- Custom Scraper Section -->
            <section id="custom-scraper" class="dashboard-section hidden p-6 bg-slate-800 rounded-lg">
              <h2 class="text-3xl font-bold mb-6 text-white">User-Friendly Custom Scraper</h2>
              <p class="text-slate-400 mb-8">
                No need for complex selectors. Just enter a URL, and we'll automatically extract the key information for you.
              </p>
              
              <div class="bg-slate-900 p-6 rounded-lg shadow-lg">
                <div class="flex items-center space-x-4">
                  <input type="url" id="custom-url-input" class="flex-grow bg-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter any website URL...">
                  <button id="start-custom-scrape-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                    <i class="fas fa-magic mr-2"></i> Auto Scrape
                  </button>
                </div>
              </div>

              <div id="custom-results-container" class="mt-8">
                <!-- Custom scraping results will be displayed here -->
              </div>
            </section>

            <!-- History Section -->
            <section id="history-section" class="section">
                <h2 class="text-2xl font-bold mb-4 text-white">Scraping History</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="history-grid">
                    <!-- History items will be dynamically loaded here -->
                </div>
            </section>
            
            <!-- Settings Section -->
            <section id="settings-section" class="section">
                <h2 class="text-2xl font-bold mb-4 text-white">Settings</h2>
                <div class="glass-card p-6">
                    <h3 class="text-lg font-semibold mb-4">Account</h3>
                    <p class="text-gray-400 mb-4">Current Plan: <span id="current-plan">Free</span></p>
                    <button class="btn-primary" onclick="upgradePlan()">Upgrade Plan</button>
                </div>
                <div class="mt-6 glass-card p-6">
                    <h3 class="text-lg font-semibold mb-4">API Keys</h3>
                    <p class="text-gray-400 mb-4">API Key: <span id="api-key">None</span></p>
                    <button class="btn-secondary" onclick="generateApiKey()">Generate New</button>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Modals -->
    <div id="article-modal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-700 flex items-center justify-between">
                <h3 class="text-xl font-semibold" id="modal-title">Article Details</h3>
                <button class="text-gray-400 hover:text-white" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6" id="modal-body">
                <!-- Article content will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Toast notifications -->
    <div id="toast-container"></div>
    
    <!-- Notification container -->
    <div id="notification-container" class="fixed top-5 right-5 z-50"></div>
    
    <!-- Loading overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-slate-800 p-6 rounded-lg">
            <div class="flex items-center gap-3">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
                <span id="loading-text">Loading...</span>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
          const socket = io("http://localhost:3000", {
            transports: ['websocket', 'polling']
          });

          // --- DOM Element Selection ---
          const navItems = document.querySelectorAll('.nav-item');
          const sections = document.querySelectorAll('.dashboard-section');
          const globalSearchInput = document.getElementById('global-search-input');
          const startScrapingBtn = document.getElementById('start-scraping-btn');
          
          // Section: News Scraper
          const newsKeywordsInput = document.getElementById('news-keywords');
          const newsCategorySelect = document.getElementById('news-category');
          const newsSourceSelect = document.getElementById('news-source');
          const scrapeNewsBtn = document.getElementById('scrape-news-btn');
          const newsResultsContainer = document.getElementById('news-results-container');

          // Section: Data Containers
          const stockDataContainer = document.getElementById('stock-data-container');
          const cryptoDataContainer = document.getElementById('crypto-data-container');
          const ecommerceResultsContainer = document.getElementById('ecommerce-results-container');

          // Section: Custom Scraper
          const customUrlInput = document.getElementById('custom-url-input');
          const startCustomScrapeBtn = document.getElementById('start-custom-scrape-btn');
          const customResultsContainer = document.getElementById('custom-results-container');
          
          // --- Notifications & Activity ---
          const notificationContainer = document.getElementById('notification-container');
          const recentActivityList = document.getElementById('recent-activity-list');
          
          // --- Global Search Results ---
          const globalSearchResultsSection = document.getElementById('global-search-results-section');
          const globalSearchResultsContainer = document.getElementById('global-search-results-container');

          // --- Initial Setup ---
          function initializeApp() {
            const initialSection = 'dashboard';
            const sectionElement = document.getElementById(initialSection);
            if (sectionElement) {
              sectionElement.classList.remove('hidden');
            }
            const activeNavItem = document.querySelector(`.nav-item[data-section="${initialSection}"]`);
            if (activeNavItem) {
              activeNavItem.classList.add('active');
            }
            loadSectionData(initialSection);
          }

          // --- Socket.IO Event Handlers ---
          socket.on('connect', () => {
            console.log('‚úÖ WebSocket connection established.');
            showNotification('Connected to server', 'success');
          });

          socket.on('disconnect', () => {
            console.log('‚ùå WebSocket connection lost.');
            showNotification('Disconnected from server', 'error');
          });
          
          socket.on('scrape_update', (result) => {
            // Check if this is a global search (from dashboard) or section-specific search
            const currentSection = document.querySelector('.nav-item.active')?.getAttribute('data-section');
            
            if (currentSection === 'dashboard') {
              // Global search - show results on dashboard
              handleGlobalSearchResponse(result);
            } else {
              // Section-specific search - show in section container
              handleScrapeResponse(result, 'News', newsResultsContainer, renderNews);
            }
          });

          socket.on('custom_scrape_update', (result) => {
            handleScrapeResponse(result, 'Custom', customResultsContainer, renderCustomResults);
          });

          function handleScrapeResponse(result, type, container, renderer) {
            if (result.success) {
              showNotification(result.message, 'success');
              renderer(result.data);
              addRecentActivity(`${type} scraping finished successfully.`, 'success');
            } else {
              showNotification(result.message || `Failed to get ${type.toLowerCase()} data.`, 'error');
              container.innerHTML = `<p class="text-red-400 text-center">${result.message}</p>`;
            }
          }
          
          function handleGlobalSearchResponse(result) {
            if (result.success) {
              showNotification(result.message, 'success');
              // Show the search results section
              globalSearchResultsSection.style.display = 'block';
              // Render the results
              renderNews(result.data, globalSearchResultsContainer);
              addRecentActivity(`Global search completed: <strong>${result.data.length} articles found</strong>`, 'success');
            } else {
              showNotification(result.message || 'Search failed', 'error');
              globalSearchResultsContainer.innerHTML = `<p class="text-red-400 text-center">${result.message}</p>`;
              globalSearchResultsSection.style.display = 'block';
            }
          }

          // --- Navigation ---
          navItems.forEach(item => {
            item.addEventListener('click', (e) => {
              e.preventDefault();
              const sectionId = item.getAttribute('data-section');
              
              navItems.forEach(nav => nav.classList.remove('active'));
              item.classList.add('active');
              
              sections.forEach(section => section.classList.add('hidden'));
              const targetSection = document.getElementById(sectionId);
              if(targetSection) {
                targetSection.classList.remove('hidden');
              }
              
              loadSectionData(sectionId);
            });
          });

          // --- Data Loading & Section Logic ---
          function loadSectionData(sectionId) {
            console.log(`Loading data for section: ${sectionId}`);
            switch (sectionId) {
              case 'dashboard': loadDashboardData(); break;
              case 'news-scraper': loadNewsData(); break;
              case 'stock-tracker': loadStockData(); break;
              case 'crypto-monitor': loadCryptoData(); break;
              case 'ecommerce': loadEcommerceData(); break;
              case 'custom-scraper':
                customResultsContainer.innerHTML = '<p class="text-center text-slate-500">Enter a URL to start scraping.</p>';
                break;
              default:
                const section = document.getElementById(sectionId);
                if (section) {
                  section.innerHTML = `<div class="text-center p-8"><h3 class="text-xl text-slate-400">Coming Soon!</h3><p class="text-slate-500">This feature is under development.</p></div>`;
                }
            }
          }

          // --- Event Listeners ---
          if(startScrapingBtn) {
            startScrapingBtn.addEventListener('click', handleGlobalSearch);
          }
          if(globalSearchInput) {
            globalSearchInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleGlobalSearch());
          }
          if(scrapeNewsBtn) {
            scrapeNewsBtn.addEventListener('click', handleNewsScrape);
          }
          if(startCustomScrapeBtn) {
            startCustomScrapeBtn.addEventListener('click', handleCustomScrape);
          }

          function handleGlobalSearch() {
            const query = globalSearchInput.value.trim();
            if (!query) return showNotification('Please enter a search term.', 'error');
            
            // Clear previous results
            globalSearchResultsContainer.innerHTML = '<div class="text-center py-8"><div class="loader"></div><p class="text-slate-400 mt-2">Searching...</p></div>';
            globalSearchResultsSection.style.display = 'block';
            
            showNotification(`Searching for "${query}"...`);
            socket.emit('scrape_request', { type: 'news', query });
            addRecentActivity(`Global search started for: <strong>${query}</strong>`);
          }

          function handleNewsScrape() {
            const keywords = newsKeywordsInput.value.trim();
            if (!keywords) return showNotification('Please enter keywords.', 'error');
            
            const request = {
              type: 'news',
              query: keywords,
              category: newsCategorySelect.value,
              source: newsSourceSelect.value
            };
            
            showNotification(`Scraping news for "${keywords}"...`);
            socket.emit('scrape_request', request);
            addRecentActivity(`News scraping started for: <strong>${keywords}</strong>`);
          }

          function handleCustomScrape() {
            const url = customUrlInput.value.trim();
            if (!url) return showNotification('Please enter a URL.', 'error');
            showNotification(`Starting auto-scrape for "${url}"...`);
            customResultsContainer.innerHTML = '<div class="text-center py-4"><div class="loader"></div><p class="text-slate-400 mt-2">Analyzing page...</p></div>';
            socket.emit('custom_scrape_request', { url });
            addRecentActivity(`Custom scraping started for: <strong>${url}</strong>`);
          }

          // --- API Fetching for Initial Data ---
          async function loadDashboardData() { /* ...logic for dashboard... */ }
          async function loadNewsData() { newsResultsContainer.innerHTML = '<p class="text-center text-slate-500">Use the controls above to find news articles.</p>'; }
          async function loadStockData() { fetchAndRender('/api/scrape/stocks', stockDataContainer, renderStocks); }
          async function loadCryptoData() { fetchAndRender('/api/scrape/crypto', cryptoDataContainer, renderCrypto); }
          function loadEcommerceData() {
            fetchAndRender('/api/scrape/ecommerce', ecommerceResultsContainer, renderEcommerce);
          }

          async function fetchAndRender(endpoint, container, renderer) {
            try {
              const res = await fetch(endpoint);
              if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
              const result = await res.json();
              if (result.success) {
                renderer(result.data, container);
              } else {
                throw new Error(result.message || 'API request failed');
              }
            } catch (e) {
              console.error(`Failed to load data from ${endpoint}:`, e);
              container.innerHTML = `<p class="text-red-400 text-center">Could not load data. ${e.message}</p>`;
            }
          }

          // --- Rendering Functions ---
          function renderStocks(data, container) {
            if (!data || data.length === 0) return container.innerHTML = '<p class="text-center text-slate-500">No stock data available.</p>';
            container.innerHTML = data.map(stock => `
              <div class="bg-slate-800 p-4 rounded-lg">
                <h4 class="text-lg font-bold text-white">${stock.name} (${stock.symbol})</h4>
                <p class="text-2xl text-green-400">$${stock.price.toFixed(2)}</p>
                <p class="${stock.change >= 0 ? 'text-green-500' : 'text-red-500'}">${stock.change.toFixed(2)} (${stock.changePercent.toFixed(2)}%)</p>
              </div>`).join('');
          }

          function renderCrypto(data, container) {
            if (!data || data.length === 0) return container.innerHTML = '<p class="text-center text-slate-500">No crypto data available.</p>';
            container.innerHTML = data.map(crypto => `
              <div class="bg-slate-800 p-4 rounded-lg">
                <h4 class="text-lg font-bold text-white">${crypto.name} (${crypto.symbol})</h4>
                <p class="text-2xl text-cyan-400">$${crypto.price.toFixed(2)}</p>
                <p class="${crypto.change >= 0 ? 'text-green-500' : 'text-red-500'}">${crypto.change.toFixed(2)} (${crypto.changePercent.toFixed(2)}%)</p>
              </div>`).join('');
          }

          function renderNews(data, container = newsResultsContainer) {
            if (!data || data.length === 0) return container.innerHTML = '<p class="text-center text-slate-500">No articles found for your query.</p>';
            container.innerHTML = data.map(article => `
              <div class="bg-slate-800 p-4 rounded-lg">
                <h4 class="text-lg font-bold text-white">${article.title}</h4>
                <p class="text-slate-400">${article.content}</p>
                <span class="text-sm text-blue-400">${article.source}</span>
              </div>`).join('');
          }

          function renderEcommerce(data, container) {
            if (!data || (Array.isArray(data) && data.length === 0)) {
                return container.innerHTML = '<p class="text-center text-slate-500">No products found.</p>';
            }
            const products = Array.isArray(data) ? data : [data];
            container.innerHTML = products.map(product => `
                <div class="bg-slate-800 p-4 rounded-lg">
                    <h4 class="text-lg font-bold text-white">${product.product_title || product.title || 'No Title'}</h4>
                    <p class="text-slate-400">${product.product_price ? '$' + product.product_price : ''}</p>
                    <span class="text-sm text-blue-400">${product.asin || ''}</span>
                </div>
            `).join('');
}

          function renderCustomResults(data, container = customResultsContainer) {
            container.innerHTML = `
              <div class="bg-slate-900 p-6 rounded-lg">
                <h3 class="text-xl font-bold text-white mb-4">${data.title}</h3>
                <div class="mb-4">
                  <h4 class="font-semibold text-slate-300 mb-2">Headings:</h4>
                  <ul class="list-disc list-inside text-slate-400">${data.headings.map(h => `<li>${h}</li>`).join('')}</ul>
                </div>
                <div>
                  <h4 class="font-semibold text-slate-300 mb-2">Links:</h4>
                  <ul class="list-disc list-inside text-slate-400">${data.links.map(l => `<li><a href="${l.href}" target="_blank" class="text-blue-400 hover:underline">${l.text}</a></li>`).join('')}</ul>
                </div>
              </div>`;
          }
          
          // --- UI Helpers ---
          function showNotification(message, type = 'info') {
            const colors = { info: 'bg-blue-500', success: 'bg-green-500', error: 'bg-red-500' };
            const notification = document.createElement('div');
            notification.className = `fixed top-5 right-5 text-white px-4 py-2 rounded-lg shadow-lg animate-fade-in-out ${colors[type]}`;
            notification.textContent = message;
            notificationContainer.appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
          }

          function addRecentActivity(html, type = 'info') {
            const icons = { info: 'fa-info-circle text-blue-400', success: 'fa-check-circle text-green-400', error: 'fa-exclamation-triangle text-red-400' };
            const item = document.createElement('div');
            item.className = 'flex items-start space-x-3 p-3 bg-slate-800/50 rounded-lg';
            item.innerHTML = `
              <i class="fas ${icons[type]} mt-1"></i>
              <div>
                <p class="text-sm text-slate-300">${html}</p>
                <p class="text-xs text-slate-500">${new Date().toLocaleTimeString()}</p>
              </div>`;
            recentActivityList.prepend(item);
            if (recentActivityList.children.length > 5) {
              recentActivityList.lastChild.remove();
            }
          }

          // --- Let's Go! ---
          initializeApp();
        });
    </script>
    <script>
// Global variables
let currentLanguage = 'english';
let currentMood = null;
let currentPlaylist = [];
let currentTrackIndex = 0;
let isScraping = false;
let useEmbeddedMode = true; // Toggle between embedded and direct play

// Language-specific song databases with working audio URLs
const songDatabases = {
  english: {
    happy: [
      { title: "Happy", artist: "Pharrell Williams", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "happy", type: "audio" },
      { title: "Good Life", artist: "OneRepublic", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "happy", type: "audio" },
      { title: "Walking on Sunshine", artist: "Katrina & The Waves", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "happy", type: "audio" }
    ],
    sad: [
      { title: "Mad World", artist: "Gary Jules", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "sad", type: "audio" },
      { title: "Hallelujah", artist: "Jeff Buckley", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "sad", type: "audio" }
    ],
    romantic: [
      { title: "Perfect", artist: "Ed Sheeran", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "romantic", type: "audio" },
      { title: "All of Me", artist: "John Legend", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "romantic", type: "audio" }
    ],
    energetic: [
      { title: "Eye of the Tiger", artist: "Survivor", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "energetic", type: "audio" },
      { title: "We Will Rock You", artist: "Queen", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "energetic", type: "audio" }
    ],
    calm: [
      { title: "Weightless", artist: "Marconi Union", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "calm", type: "audio" },
      { title: "Claire de Lune", artist: "Debussy", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "calm", type: "audio" }
    ],
    party: [
      { title: "Uptown Funk", artist: "Mark Ronson ft. Bruno Mars", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "party", type: "audio" },
      { title: "Shake It Off", artist: "Taylor Swift", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "party", type: "audio" }
    ]
  },
  hindi: {
    happy: [
      { title: "Bole Chudiyan", artist: "Jatin-Lalit", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "happy", type: "audio" },
      { title: "Mast Kalandar", artist: "Various Artists", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "happy", type: "audio" }
    ],
    sad: [
      { title: "Tum Hi Ho", artist: "Arijit Singh", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "sad", type: "audio" },
      { title: "Raabta", artist: "Pritam", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "sad", type: "audio" }
    ],
    romantic: [
      { title: "Tum Se Hi", artist: "Mohit Chauhan", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "romantic", type: "audio" },
      { title: "Raabta", artist: "Pritam", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "romantic", type: "audio" }
    ],
    energetic: [
      { title: "Jai Ho", artist: "A.R. Rahman", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "energetic", type: "audio" },
      { title: "Chak De India", artist: "Salim-Sulaiman", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "energetic", type: "audio" }
    ],
    calm: [
      { title: "Agar Tum Saath Ho", artist: "Arijit Singh", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "calm", type: "audio" },
      { title: "Raabta", artist: "Pritam", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "calm", type: "audio" }
    ],
    party: [
      { title: "Badtameez Dil", artist: "Pritam", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "party", type: "audio" },
      { title: "Balam Pichkari", artist: "Pritam", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "party", type: "audio" }
    ]
  },
  punjabi: {
    happy: [
      { title: "Lahore", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "happy", type: "audio" },
      { title: "High Rated Gabru", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "happy", type: "audio" }
    ],
    sad: [
      { title: "Suit", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "sad", type: "audio" },
      { title: "Patola", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "sad", type: "audio" }
    ],
    romantic: [
      { title: "Suit", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "romantic", type: "audio" },
      { title: "Patola", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "romantic", type: "audio" }
    ],
    energetic: [
      { title: "Lahore", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "energetic", type: "audio" },
      { title: "High Rated Gabru", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "energetic", type: "audio" }
    ],
    calm: [
      { title: "Suit", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "calm", type: "audio" },
      { title: "Patola", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "calm", type: "audio" }
    ],
    party: [
      { title: "Lahore", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "party", type: "audio" },
      { title: "High Rated Gabru", artist: "Guru Randhawa", url: "https://www2.cs.uic.edu/~i101/SoundFiles/BabyElephantWalk60.wav", mood: "party", type: "audio" }
    ]
  }
};

// Select language function
function selectLanguage(language) {
  // Remove active class from all language buttons
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.style.background = '#6b7280';
  });
  
  // Add active class to selected language button
  document.querySelector(`[data-lang="${language}"]`).style.background = '#3b82f6';
  
  currentLanguage = language;
  console.log(`Selected language: ${language}`);
  
  // Clear current playlist if mood is selected
  if (currentMood) {
    currentPlaylist = [];
    document.getElementById('track-list').style.display = 'none';
    document.getElementById('playlist-info').style.display = 'none';
  }
}

// Select mood function
function selectMood(mood) {
  // Remove active class from all mood buttons
  document.querySelectorAll('.mood-btn').forEach(btn => {
    btn.style.opacity = '0.7';
  });
  
  // Add active class to selected button
  document.querySelector(`[data-mood="${mood}"]`).style.opacity = '1';
  
  currentMood = mood;
  console.log(`Selected ${mood} mood for ${currentLanguage} language`);
}

// Search songs function
async function searchSongs() {
  const searchTerm = document.getElementById('song-search').value.trim();
  if (!searchTerm) {
    alert('Please enter a search term!');
    return;
  }
  
  showLoading(true);
  
  try {
    // Simulate API call to search for songs
    const searchResults = await searchSongsAPI(searchTerm, currentLanguage);
    currentPlaylist = searchResults;
    currentTrackIndex = 0;
    
    displayPlaylistInfo(`Search Results for "${searchTerm}"`);
    displayTracks();
    showLoading(false);
    
  } catch (error) {
    console.error('Search error:', error);
    alert('Failed to search songs. Please try again.');
    showLoading(false);
  }
}

// Generate mood playlist function
async function generateMoodPlaylist() {
  if (!currentMood) {
    alert('Please select a mood first!');
    return;
  }
  
  showLoading(true);
  
  try {
    // Simulate API call to generate mood-based playlist
    const playlist = await generateMoodPlaylistAPI(currentMood, currentLanguage);
    currentPlaylist = playlist;
    currentTrackIndex = 0;
    
    displayPlaylistInfo(`${currentMood.charAt(0).toUpperCase() + currentMood.slice(1)} Mood Playlist (${currentLanguage})`);
    displayTracks();
    showLoading(false);
    
  } catch (error) {
    console.error('Playlist generation error:', error);
    alert('Failed to generate playlist. Please try again.');
    showLoading(false);
  }
}

// Mock API functions (replace with real API calls)
async function searchSongsAPI(searchTerm, language) {
  return new Promise((resolve) => {
    setTimeout(() => {
      // Simulate search results
      const allSongs = getAllSongsForLanguage(language);
      const results = allSongs.filter(song => 
        song.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
        song.artist.toLowerCase().includes(searchTerm.toLowerCase())
      );
      resolve(results.slice(0, 10)); // Limit to 10 results
    }, 2000);
  });
}

async function generateMoodPlaylistAPI(mood, language) {
  return new Promise((resolve) => {
    setTimeout(() => {
      const moodSongs = songDatabases[language][mood] || [];
      // Add some random songs from other moods for variety
      const allSongs = getAllSongsForLanguage(language);
      const randomSongs = allSongs.filter(song => song.mood !== mood).slice(0, 3);
      const playlist = [...moodSongs, ...randomSongs];
      resolve(playlist);
    }, 3000);
  });
}

// Helper function to get all songs for a language
function getAllSongsForLanguage(language) {
  const allSongs = [];
  const languageSongs = songDatabases[language];
  
  for (const mood in languageSongs) {
    allSongs.push(...languageSongs[mood]);
  }
  
  return allSongs;
}

// Show/hide loading indicator
function showLoading(show) {
  const loadingIndicator = document.getElementById('loading-indicator');
  const generateBtn = document.getElementById('generate-btn');
  
  if (show) {
    loadingIndicator.style.display = 'block';
    generateBtn.disabled = true;
    generateBtn.textContent = 'Generating...';
  } else {
    loadingIndicator.style.display = 'none';
    generateBtn.disabled = false;
    generateBtn.textContent = 'üéµ Generate Playlist';
  }
}

// Display playlist info
function displayPlaylistInfo(title) {
  document.getElementById('playlist-info').style.display = 'block';
  document.getElementById('current-mood-title').textContent = title;
  document.getElementById('track-list').style.display = 'block';
}

// Display tracks function
function displayTracks() {
  const container = document.getElementById('tracks-container');
  
  if (currentPlaylist.length === 0) {
    container.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 2rem;">No tracks found</p>';
    return;
  }
  
  container.innerHTML = currentPlaylist.map((track, index) => `
    <div style="padding: 0.5rem; border-bottom: 1px solid #374151; cursor: pointer;" 
         onclick="playTrack(${index})" 
         onmouseover="this.style.backgroundColor='#374151'" 
         onmouseout="this.style.backgroundColor='transparent'">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: bold;">${track.title}</div>
          <div style="color: #9ca3af; font-size: 0.9rem;">${track.artist}</div>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span style="background: #374151; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem;">${track.mood}</span>
                             <span style="background: #3b82f6; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; color: white;">${track.type}</span>
          <button onclick="event.stopPropagation(); playTrack(${index})" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
            <i class="fas fa-play"></i>
          </button>
        </div>
      </div>
    </div>
  `).join('');
}

// Play specific track function
function playTrack(index) {
  if (index < 0 || index >= currentPlaylist.length) return;

  currentTrackIndex = index;
  const track = currentPlaylist[index];
  const audio = document.getElementById('audio-player');
  const musicPlayer = document.getElementById('music-player');
  musicPlayer.style.display = 'block';

  document.getElementById('current-song-title').textContent = track.title;
  document.getElementById('current-song-artist').textContent = track.artist;

  // Remove previous event listeners to avoid stacking
  audio.oncanplay = null;
  audio.onerror = null;
  audio.onended = null;

  audio.src = track.url;
  audio.load();

  audio.oncanplay = function() {
    audio.play().then(() => {
      showNotification(`üéµ Now playing: ${track.title} by ${track.artist}`, 'success');
      const playPauseBtn = document.getElementById('play-pause-btn');
      playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
      playPauseBtn.onclick = togglePlayPause;
    }).catch(error => {
      showNotification('Error playing track. Skipping to next...', 'warning');
      nextTrack();
    });
  };

  audio.onerror = function() {
    showNotification('Audio file not available. Skipping to next...', 'warning');
    setTimeout(() => {
      nextTrack();
    }, 1000);
  };

  audio.onended = function() {
    nextTrack();
  };

  updateCurrentTrackDisplay();
}

// Toggle play mode function (now for audio quality)
function togglePlayMode() {
  useEmbeddedMode = !useEmbeddedMode;
  const modeBtn = document.getElementById('play-mode-btn');
  
  if (useEmbeddedMode) {
    modeBtn.textContent = 'üéµ High Quality Audio';
    modeBtn.style.background = '#7c3aed';
    showNotification('Switched to High Quality Audio Mode', 'success');
  } else {
    modeBtn.textContent = 'üîä Standard Audio';
    modeBtn.style.background = '#059669';
    showNotification('Switched to Standard Audio Mode', 'success');
  }
}

// Alternative play function that tries multiple approaches
function playTrackAlternative(index) {
  if (index < 0 || index >= currentPlaylist.length) return;
  
  currentTrackIndex = index;
  const track = currentPlaylist[index];
  
  // Try direct YouTube link first
  const videoId = track.url;
  const directUrl = `https://www.youtube.com/watch?v=${videoId}`;
  
  // Show notification
  showNotification(`üéµ Opening: ${track.title}`, 'info');
  
  // Open in new tab as fallback
  setTimeout(() => {
    window.open(directUrl, '_blank');
  }, 1000);
  
  updateCurrentTrackDisplay();
}

// Audio player controls
function togglePlayPause() {
  const audio = document.getElementById('audio-player');
  const playPauseBtn = document.getElementById('play-pause-btn');
  
  if (audio.paused) {
    audio.play();
    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
  } else {
    audio.pause();
    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
  }
}

// Previous track function
function previousTrack() {
  if (currentTrackIndex > 0) {
    playTrack(currentTrackIndex - 1);
  }
}

// Next track function
function nextTrack() {
  if (currentTrackIndex < currentPlaylist.length - 1) {
    playTrack(currentTrackIndex + 1);
  }
}

// Seek to position function
function seekTo(event) {
  const audio = document.getElementById('audio-player');
  const progressBar = event.currentTarget;
  const rect = progressBar.getBoundingClientRect();
  const percent = (event.clientX - rect.left) / rect.width;
  
  if (audio.duration) {
    audio.currentTime = percent * audio.duration;
  }
}

// Toggle play/pause function
function togglePlayPause() {
  const iframe = document.getElementById('embedded-video');
  const playPauseBtn = document.getElementById('play-pause-btn');
  
  if (iframe) {
    // Send message to iframe to play/pause
    iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
    
    // Toggle button state
    if (playPauseBtn.innerHTML.includes('play')) {
      playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
    } else {
      playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
    }
  }
}

// Previous track function
function previousTrack() {
  if (currentTrackIndex > 0) {
    playTrack(currentTrackIndex - 1);
  }
}

// Next track function
function nextTrack() {
  if (currentTrackIndex < currentPlaylist.length - 1) {
    playTrack(currentTrackIndex + 1);
  }
}

// Seek to position function
function seekTo(event) {
  const progressBar = event.currentTarget;
  const rect = progressBar.getBoundingClientRect();
  const percent = (event.clientX - rect.left) / rect.width;
  
  const iframe = document.getElementById('embedded-video');
  if (iframe) {
    // Send seek command to iframe
    iframe.contentWindow.postMessage(`{"event":"command","func":"seekTo","args":[${Math.floor(percent * 100)}]}`, '*');
  }
}

// Show notification function
function showNotification(message, type = 'info') {
  // Create notification element
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : '#3b82f6'};
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    z-index: 1000;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    transform: translateX(400px);
    transition: transform 0.3s ease;
  `;
  notification.textContent = message;
  
  document.body.appendChild(notification);
  
  // Animate in
  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.transform = 'translateX(400px)';
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// Play mood playlist function
function playMoodPlaylist() {
  if (!currentMood || currentPlaylist.length === 0) {
    alert('Please select a mood and generate playlist first!');
    return;
  }
  
  playTrack(0);
}

// Update current track display
function updateCurrentTrackDisplay() {
  const tracks = document.querySelectorAll('#tracks-container > div');
  tracks.forEach((track, index) => {
    if (index === currentTrackIndex) {
      track.style.backgroundColor = '#3b82f6';
      track.style.color = 'white';
    } else {
      track.style.backgroundColor = 'transparent';
      track.style.color = 'inherit';
    }
  });
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
  const audio = document.getElementById('audio-player');
  
  // Auto-play next track when current ends
  audio.addEventListener('ended', function() {
    currentTrackIndex++;
    if (currentTrackIndex < currentPlaylist.length) {
      playTrack(currentTrackIndex);
    }
  });
  
  // Update progress bar and time display
  audio.addEventListener('timeupdate', function() {
    const progressBar = document.getElementById('progress-bar');
    const currentTime = document.getElementById('current-time');
    const totalTime = document.getElementById('total-time');
    
    if (audio.duration && !isNaN(audio.duration)) {
      const progress = (audio.currentTime / audio.duration) * 100;
      progressBar.style.width = progress + '%';
      
      currentTime.textContent = formatTime(audio.currentTime);
      totalTime.textContent = formatTime(audio.duration);
    }
  });
  
  // Handle loadedmetadata event for duration
  audio.addEventListener('loadedmetadata', function() {
    const totalTime = document.getElementById('total-time');
    if (audio.duration && !isNaN(audio.duration)) {
      totalTime.textContent = formatTime(audio.duration);
    }
  });
  
  // Handle canplay event
  audio.addEventListener('canplay', function() {
    const totalTime = document.getElementById('total-time');
    if (audio.duration && !isNaN(audio.duration)) {
      totalTime.textContent = formatTime(audio.duration);
    }
  });
  
  // Handle volume control
  const volumeControl = document.getElementById('volume-control');
  volumeControl.addEventListener('input', function() {
    audio.volume = this.value / 100;
  });
  
  // Handle search input enter key
  document.getElementById('song-search').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      searchSongs();
    }
  });
  
  // Set initial volume
  audio.volume = 0.5;
  
  console.log('Mood Playlist initialized with audio-only support');
});

// Format time function
function formatTime(seconds) {
  if (isNaN(seconds) || seconds === Infinity) {
    return '0:00';
  }
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = Math.floor(seconds % 60);
  return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
}
</script>
</body>
</html> 